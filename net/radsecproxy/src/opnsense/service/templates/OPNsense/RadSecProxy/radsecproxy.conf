{% if helpers.exists('OPNsense.radsecproxy.general') and OPNsense.radsecproxy.general.Enabled|default("0") == "1" %}
{% set certDir = '/usr/local/etc/radsecproxy.d/certs/' %}

[general]
SMTPHost={{ OPNsense.radsecproxy.general.Enabled|default("") }}

{{ OPNsense.radsecproxy.tlsConfigs }}
{{ OPNsense.radsecproxy.clients }}

{% for tlsConfig in helpers.toList('OPNsense.radsecproxy.tlsConfigs.tlsConfig') %}

# config for {{ tlsConfig }}
tls {{ tlsConfig.name }} {
    CACertificateFile   {{ certDir}}{{ tlsConfig.name }}_ca-cert.pem
    CertificateFile     {{ certDir}}{{ tlsConfig.name }}_proxy-cert.pem
    CertificateKeyFile  {{ certDir}}{{ tlsConfig.name }}_proxy-key.pem
}

{% endfor %}

{% for client in helpers.toList('OPNsense.radsecproxy.clients.client') %}
# config for {{ client }}
# config for client "{{ client.description }}"
client {{ client.host }} {
  Type {{ client.type }}
{% if client.secret|default("") != "" %}
  Secret {{ client.secret }}
{% endif %}
{% if client.customConfig|default("") != "" %}
  {{ client.customConfig }}
{% endif %}
}
{% endfor %}

{% for server in helpers.toList('OPNsense.radsecproxy.servers.server') %}
# config for {{ server }}
# config for server "{{ server.description }}"
{% if server.port|default("") != "" %}
server {{ server.host }}:{{ server.port }} {
{% else %}
server {{ server.host }} {
{% endif %}
  Type {{ server.type }}
{% if server.secret|default("") != "" %}
  Secret {{ server.secret }}
{% endif %}
{% if server.tlsConfig|default("") != "" %}
{% set tlsConfig = helpers.getUUID(server.tlsConfig) %}
  Tls {{ tlsConfig.name }}
{% endif %}
  StatusServer {{ server.statusServer }}
  CertificateNameCheck {{ server.certificateNameCheck }}
{% if server.customConfig|default("") != "" %}
  {{ server.customConfig }}
{% endif %}
{% if server.matchCertificateAttribute|default("") != "" %}
  matchCertificateAttribute {{ server.matchCertificateAttribute }}
{% endif %}
}
{% endfor %}

{% endif %}